<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASL Learning App</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: linear-gradient(135deg, #FFD54F 0%, #FFA726 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(255, 193, 7, 0.3); }
        h1 { color: #F57C00; text-align: center; margin-bottom: 10px; font-size: 32px; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 14px; }
        .mode-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .mode-card { background: linear-gradient(135deg, #FFF9C4 0%, #FFEB3B 100%); padding: 25px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s; border: 3px solid transparent; }
        .mode-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(255, 193, 7, 0.4); }
        .mode-card.active { border-color: #F57C00; background: linear-gradient(135deg, #FFD54F 0%, #FFC107 100%); }
        .mode-icon { font-size: 48px; margin-bottom: 10px; }
        .mode-title { font-size: 20px; font-weight: 700; color: #F57C00; margin-bottom: 5px; }
        .mode-desc { font-size: 13px; color: #666; }
        .content-area { display: none; }
        .content-area.active { display: block; }
        .camera-container { position: relative; width: 100%; max-width: 500px; margin: 0 auto 20px; border-radius: 15px; overflow: hidden; background: #000; border: 4px solid #FFC107; }
        video { width: 100%; display: block; transform: scaleX(-1); }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: scaleX(-1); }
        button { background: linear-gradient(135deg, #FFC107 0%, #FF9800 100%); color: #fff; border: none; padding: 15px 30px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin: 5px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3); }
        button:hover { background: linear-gradient(135deg, #FFD54F 0%, #FFA726 100%); transform: translateY(-2px); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        button.secondary { background: #fff; color: #F57C00; border: 2px solid #FFC107; box-shadow: none; }
        .lesson-card { background: #FFF9C4; padding: 25px; border-radius: 15px; margin-bottom: 20px; border-left: 5px solid #FFC107; }
        .lesson-title { font-size: 24px; font-weight: 700; color: #F57C00; margin-bottom: 15px; }
        .lesson-steps { list-style: none; padding: 0; }
        .lesson-steps li { padding: 12px; margin: 8px 0; background: white; border-radius: 8px; font-size: 15px; border-left: 3px solid #FFB300; }
        .quiz-question { background: #FFF9C4; padding: 30px; border-radius: 15px; margin-bottom: 20px; text-align: center; }
        .quiz-prompt { font-size: 28px; font-weight: 700; color: #F57C00; margin-bottom: 20px; }
        .sign-library { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; margin: 20px 0; }
        .sign-card { background: #FFF9C4; padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s; border: 3px solid transparent; }
        .sign-card:hover { background: #FFECB3; transform: translateY(-3px); }
        .sign-card.active { border-color: #F57C00; background: #FFD54F; }
        .sign-emoji { font-size: 36px; margin-bottom: 8px; }
        .sign-name { font-weight: 600; color: #F57C00; font-size: 13px; }
        .feedback { text-align: center; padding: 20px; border-radius: 15px; margin: 20px 0; font-weight: 600; font-size: 18px; }
        .feedback.success { background: #C8E6C9; color: #2E7D32; }
        .feedback.waiting { background: #FFF9C4; color: #F57C00; }
        .stats { display: flex; justify-content: space-around; margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #FFF9C4 0%, #FFECB3 100%); border-radius: 15px; }
        .stat-value { font-size: 32px; font-weight: 700; color: #F57C00; }
        .stat-label { font-size: 12px; color: #666; margin-top: 5px; }
        .hidden { display: none; }
        .info-box { background: #FFF9C4; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 13px; color: #F57C00; border-left: 4px solid #FFC107; }
        .progress-bar { width: 100%; height: 10px; background: #FFECB3; border-radius: 10px; overflow: hidden; margin: 20px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #FFC107 0%, #FF9800 100%); transition: width 0.3s; }
        .controls { text-align: center; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ü ASL Learning App</h1>
        <p class="subtitle">Learn American Sign Language in three easy modes!</p>
        
        <div class="mode-selector">
            <div class="mode-card active" data-mode="learn"><div class="mode-icon">üìö</div><div class="mode-title">LEARN</div><div class="mode-desc">Step-by-step tutorials</div></div>
            <div class="mode-card" data-mode="test"><div class="mode-icon">‚úèÔ∏è</div><div class="mode-title">TEST</div><div class="mode-desc">Quiz your knowledge</div></div>
            <div class="mode-card" data-mode="practice"><div class="mode-icon">üí™</div><div class="mode-title">PRACTICE</div><div class="mode-desc">Free practice mode</div></div>
        </div>
        
        <div id="learnMode" class="content-area active">
            <div class="info-box">üìñ <strong>Learn Mode:</strong> Follow the lessons to learn basic ASL signs!</div>
            <div class="progress-bar"><div class="progress-fill" id="learnProgress" style="width: 0%"></div></div>
            <div id="lessonsContainer"></div>
            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                <button class="secondary" id="prevLesson">‚Üê Previous</button>
                <button id="nextLesson">Next Lesson ‚Üí</button>
            </div>
        </div>
        
        <div id="testMode" class="content-area">
            <div class="info-box">‚úèÔ∏è <strong>Test Mode:</strong> Make the sign shown. Camera will detect if correct!</div>
            <div class="stats"><div class="stat"><div class="stat-value" id="testScore">0</div><div class="stat-label">Correct</div></div><div class="stat"><div class="stat-value" id="testTotal">0</div><div class="stat-label">Total</div></div></div>
            <div class="camera-container"><video id="testVideo" autoplay playsinline></video><canvas id="testCanvas"></canvas></div>
            <div class="controls"><button id="startTestCamera">Start Camera</button><button id="stopTestCamera" class="hidden">Stop</button></div>
            <div id="quizContainer"></div>
            <div class="controls"><button id="nextQuestion">Next Question ‚Üí</button></div>
        </div>
        
        <div id="practiceMode" class="content-area">
            <div class="info-box">üí™ <strong>Practice Mode:</strong> Choose any sign and practice at your pace!</div>
            <div class="stats"><div class="stat"><div class="stat-value" id="practiceScore">0</div><div class="stat-label">Correct</div></div><div class="stat"><div class="stat-value" id="practiceAttempts">0</div><div class="stat-label">Attempts</div></div></div>
            <div class="camera-container"><video id="practiceVideo" autoplay playsinline></video><canvas id="practiceCanvas"></canvas></div>
            <div class="controls"><button id="startPracticeCamera">Start Camera</button><button id="stopPracticeCamera" class="hidden">Stop</button></div>
            <div id="practiceFeedback" class="feedback waiting">Select a sign to practice</div>
            <div class="sign-library" id="practiceLibrary"></div>
        </div>
    </div>

    <script>
        const signs = [
            {name:'Hello',emoji:'üëã',id:'hello',desc:'Salute from forehead',steps:['Open hand, fingers together','Touch fingertips to forehead','Move forward like salute']},
            {name:'Thank You',emoji:'üôè',id:'thanks',desc:'Hand from chin forward',steps:['Open hand, fingers together','Touch to chin','Move forward and down']},
            {name:'Please',emoji:'‚úã',id:'please',desc:'Circle on chest',steps:['Flat hand on chest','Make circular motion','Repeat 2-3 times']},
            {name:'Yes',emoji:'‚úä',id:'yes',desc:'Fist nods',steps:['Make fist','Move up and down','Like nodding']},
            {name:'No',emoji:'‚úåÔ∏è',id:'no',desc:'Fingers tap thumb',steps:['Index and middle up','Tap against thumb','Like mouth saying no']},
            {name:'A',emoji:'A',id:'a',desc:'Fist, thumb aside',steps:['Make fist','Thumb on side','Keep firm']},
            {name:'I',emoji:'I',id:'i',desc:'Pinky up',steps:['Make fist','Extend pinky only','Others down']},
            {name:'L',emoji:'L',id:'l',desc:'L-shape',steps:['Thumb sideways','Index up','Forms L']},
            {name:'Y',emoji:'Y',id:'y',desc:'Thumb & pinky out',steps:['Make fist','Extend thumb and pinky','Hang loose']},
            {name:'1',emoji:'1Ô∏è‚É£',id:'one',desc:'Index up',steps:['Make fist','Index up','Point up']},
            {name:'2',emoji:'2Ô∏è‚É£',id:'two',desc:'V shape',steps:['Make fist','Index and middle','Spread apart']},
            {name:'5',emoji:'5Ô∏è‚É£',id:'five',desc:'Open hand',steps:['Open completely','All fingers spread','Palm forward']}
        ];
        
        let mode='learn',lesson=0,testScore=0,testTotal=0,practiceScore=0,practiceAttempts=0,currentTest=null,currentPractice=null,hands,testCam,practiceCam,lastDet=null;
        
        document.querySelectorAll('.mode-card').forEach(c=>c.onclick=()=>{
            mode=c.dataset.mode;
            document.querySelectorAll('.mode-card').forEach(x=>x.classList.remove('active'));
            c.classList.add('active');
            document.querySelectorAll('.content-area').forEach(x=>x.classList.remove('active'));
            document.getElementById(mode+'Mode').classList.add('active');
        });
        
        function renderLesson(i){
            const s=signs[i];
            document.getElementById('lessonsContainer').innerHTML=`<div class="lesson-card"><div class="lesson-title">${s.emoji} ${s.name}</div><p style="margin-bottom:15px;color:#666">${s.desc}</p><ul class="lesson-steps">${s.steps.map((st,j)=>`<li><strong>Step ${j+1}:</strong> ${st}</li>`).join('')}</ul></div>`;
            document.getElementById('learnProgress').style.width=((i+1)/signs.length*100)+'%';
            document.getElementById('prevLesson').disabled=i===0;
            document.getElementById('nextLesson').textContent=i===signs.length-1?'Finish! üéâ':'Next ‚Üí';
        }
        
        document.getElementById('prevLesson').onclick=()=>{if(lesson>0){lesson--;renderLesson(lesson);}};
        document.getElementById('nextLesson').onclick=()=>{if(lesson<signs.length-1){lesson++;renderLesson(lesson);}else alert('üéâ Done!');};
        renderLesson(0);
        
        function genQuestion(){
            currentTest=signs[Math.floor(Math.random()*signs.length)];
            document.getElementById('quizContainer').innerHTML=`<div class="quiz-question"><div class="quiz-prompt">Make: "${currentTest.name}" ${currentTest.emoji}</div><p style="color:#666;margin-top:10px">${currentTest.desc}</p></div>`;
        }
        document.getElementById('nextQuestion').onclick=genQuestion;
        genQuestion();
        
        signs.forEach(s=>{
            const c=document.createElement('div');
            c.className='sign-card';
            c.innerHTML=`<div class="sign-emoji">${s.emoji}</div><div class="sign-name">${s.name}</div>`;
            c.onclick=()=>{
                currentPractice=s;
                document.querySelectorAll('#practiceLibrary .sign-card').forEach(x=>x.classList.remove('active'));
                c.classList.add('active');
                document.getElementById('practiceFeedback').className='feedback waiting';
                document.getElementById('practiceFeedback').textContent=`Practice: "${s.name}"`;
            };
            document.getElementById('practiceLibrary').appendChild(c);
        });
        
        function isFExt(l,t,p){return l[t].y<l[p].y-0.03;}
        function detect(l,t){
            if(!l||!t)return false;
            const tE=l[4].x<l[3].x-0.05||l[4].x>l[3].x+0.05,iE=isFExt(l,8,6),mE=isFExt(l,12,10),rE=isFExt(l,16,14),pE=isFExt(l,20,18);
            const p={hello:iE&&mE&&rE&&pE,thanks:iE&&mE&&rE&&pE,please:iE&&mE&&rE&&pE,yes:!iE&&!mE&&!rE&&!pE,no:iE&&mE&&!rE&&!pE,a:!iE&&!mE&&!rE&&!pE&&tE,i:pE&&!iE&&!mE&&!rE,l:tE&&iE&&!mE&&!rE&&!pE,y:tE&&!iE&&!mE&&!rE&&pE,one:iE&&!mE&&!rE&&!pE,two:iE&&mE&&!rE&&!pE,five:tE&&iE&&mE&&rE&&pE};
            return p[t.id]||false;
        }
        
        function onTestRes(r){
            const cv=document.getElementById('testCanvas'),v=document.getElementById('testVideo'),ctx=cv.getContext('2d');
            cv.width=v.videoWidth;cv.height=v.videoHeight;ctx.clearRect(0,0,cv.width,cv.height);
            if(r.multiHandLandmarks&&r.multiHandLandmarks.length>0&&currentTest){
                if(detect(r.multiHandLandmarks[0],currentTest)){
                    const n=Date.now();
                    if(!lastDet||n-lastDet>2000){
                        testScore++;testTotal++;lastDet=n;
                        document.getElementById('testScore').textContent=testScore;
                        document.getElementById('testTotal').textContent=testTotal;
                        document.getElementById('quizContainer').innerHTML='<div class="quiz-question"><div class="quiz-prompt" style="color:#4CAF50">‚úÖ Correct!</div></div>';
                        setTimeout(genQuestion,2000);
                    }
                }
            }
        }
        
        function onPracticeRes(r){
            const cv=document.getElementById('practiceCanvas'),v=document.getElementById('practiceVideo'),ctx=cv.getContext('2d');
            cv.width=v.videoWidth;cv.height=v.videoHeight;ctx.clearRect(0,0,cv.width,cv.height);
            if(r.multiHandLandmarks&&r.multiHandLandmarks.length>0&&currentPractice){
                if(detect(r.multiHandLandmarks[0],currentPractice)){
                    const n=Date.now();
                    if(!lastDet||n-lastDet>2000){
                        practiceScore++;practiceAttempts++;lastDet=n;
                        document.getElementById('practiceScore').textContent=practiceScore;
                        document.getElementById('practiceAttempts').textContent=practiceAttempts;
                        const f=document.getElementById('practiceFeedback');
                        f.className='feedback success';
                        f.textContent=`‚úÖ Perfect "${currentPractice.name}"!`;
                        setTimeout(()=>{f.className='feedback waiting';f.textContent=`Practice: "${currentPractice.name}"`;},2000);
                    }
                }
            }
        }
        
        document.getElementById('startTestCamera').onclick=async()=>{
            try{
                hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
                hands.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:0.7,minTrackingConfidence:0.7});
                hands.onResults(onTestRes);
                const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}});
                document.getElementById('testVideo').srcObject=s;
                testCam=new Camera(document.getElementById('testVideo'),{onFrame:async()=>{await hands.send({image:document.getElementById('testVideo')});},width:640,height:480});
                await testCam.start();
                document.getElementById('startTestCamera').classList.add('hidden');
                document.getElementById('stopTestCamera').classList.remove('hidden');
            }catch(e){alert('Camera error: '+e.message);}
        };
        
        document.getElementById('stopTestCamera').onclick=()=>{
            if(testCam)testCam.stop();
            if(document.getElementById('testVideo').srcObject)document.getElementById('testVideo').srcObject.getTracks().forEach(t=>t.stop());
            document.getElementById('stopTestCamera').classList.add('hidden');
            document.getElementById('startTestCamera').classList.remove('hidden');
        };
        
        document.getElementById('startPracticeCamera').onclick=async()=>{
            try{
                hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
                hands.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:0.7,minTrackingConfidence:0.7});
                hands.onResults(onPracticeRes);
                const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}});
                document.getElementById('practiceVideo').srcObject=s;
                practiceCam=new Camera(document.getElementById('practiceVideo'),{onFrame:async()=>{await hands.send({image:document.getElementById('practiceVideo')});},width:640,height:480});
                await practiceCam.start();
                document.getElementById('startPracticeCamera').classList.add('hidden');
                document.getElementById('stopPracticeCamera').classList.remove('hidden');
            }catch(e){alert('Camera error: '+e.message);}
        };
        
        document.getElementById('stopPracticeCamera').onclick=()=>{
            if(practiceCam)practiceCam.stop();
            if(document.getElementById('practiceVideo').srcObject)document.getElementById('practiceVideo').srcObject.getTracks().forEach(t=>t.stop());
            document.getElementById('stopPracticeCamera').classList.add('hidden');
            document.getElementById('startPracticeCamera').classList.remove('hidden');
        };
    </script>
</body>
</html>
